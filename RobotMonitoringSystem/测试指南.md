# 🎯 Web 监控系统测试指南

## ✅ 当前系统状态

### 运行中的服务

| 服务 | 状态 | 说明 |
|------|------|------|
| **SimRobot** | 🟢 运行中 | GameFast.ros3 场景，10 个机器人 |
| **GameController** | 🟢 已连接 | 端口 3838（控制比赛状态）|
| **Web Monitor** | 🟢 运行中 | 端口 8080/8765/10020（监控系统）|
| **机器人数据** | ✅ 10/10 在线 | 所有机器人正在上报数据 |

### 端口分配

| 端口 | 用途 | 服务 |
|------|------|------|
| 3838 | GameController → Robot | GC 控制 |
| 3939 | Robot → GameController | GC 心跳 |
| 10020 | Robot → Monitor | 监控数据（UDP）|
| 8080 | Browser → Monitor | Web 页面（HTTP）|
| 8765 | Monitor → Browser | 实时推送（WebSocket）|

## 🌐 访问地址

### 实时监控页面（中文界面）
```
http://localhost:8080/static/index.html
```

**功能：**
- 🤖 实时显示 10 个机器人卡片
- 🔋 电量、温度实时更新
- 🧠 行为状态
- 🤸 摔倒状态（红色背景）
- ⚽ 球可见性
- 📡 在线/离线状态
- 🔌 WebSocket 自动重连

### 历史日志页面（中文界面）
```
http://localhost:8080/static/logs.html
```

**功能：**
- 📅 选择比赛
- 🤖 选择机器人
- ⏱️ 时间轴统计
- 📋 事件列表
- 📄 原始数据查看

## 🧪 测试步骤

### 1. 测试实时监控页面

**步骤：**
1. 在浏览器中打开：`http://localhost:8080/static/index.html`
2. 检查页面标题：🤖 机器人监控系统 - 实时监控
3. 检查连接状态：应显示 "🟢 已连接"
4. 检查机器人数量：应显示 "10 个机器人"

**预期效果：**
- ✅ 显示 10 个机器人卡片（5 队和 70 队）
- ✅ 每个卡片显示：
  - 机器人 ID（如 5_1, 70_1）
  - 在线状态（绿色边框）
  - 电量（100%）
  - 温度（40°C）
  - 行为（unknown 或具体行为）
  - 运动状态（stand/walk）
  - 摔倒状态（正常/摔倒）
  - 球可见性（可见/不可见）
  - 时间戳

**测试要点：**
- [ ] 页面自动刷新（数据实时更新）
- [ ] 机器人摔倒时卡片背景变红
- [ ] 球可见性图标正确显示（⚽/❌）
- [ ] 离线机器人变灰（停止 SimRobot 后 5 秒）

### 2. 测试历史日志页面

**步骤：**
1. 点击页面右上角 "📊 查看日志" 按钮
2. 或直接访问：`http://localhost:8080/static/logs.html`
3. 在 "比赛" 下拉框中选择最新的比赛
4. 在 "机器人" 下拉框中选择一个机器人（如 5_5）
5. 点击 "📥 加载数据" 按钮

**预期效果：**
- ✅ 显示日志信息：
  - 比赛 ID
  - 机器人 ID
  - 总数据包数量
  - 已加载数据量
- ✅ 显示时间轴：
  - 持续时间（X分 X秒）
  - 开始/结束时间
  - 摔倒次数和百分比
  - 球可见率
- ✅ 显示事件列表：
  - 🤸 机器人摔倒
  - ✅ 机器人恢复
  - ⚽ 发现球
  - ❌ 丢失球
- ✅ 显示原始数据（JSON 格式）

**测试要点：**
- [ ] 比赛列表正确加载
- [ ] 机器人列表正确加载
- [ ] 数据加载成功
- [ ] 统计信息准确
- [ ] 事件时间戳正确

### 3. 测试 GameController 共存

**步骤：**
1. 在 GameController 中改变比赛状态（如从 INITIAL → READY → SET → PLAYING）
2. 观察 Web 监控页面是否继续正常工作
3. 在 GC 中罚下一个机器人
4. 观察 Web 监控页面是否仍然显示该机器人数据

**预期效果：**
- ✅ GC 控制比赛状态不影响监控系统
- ✅ 监控系统继续接收和显示数据
- ✅ 两个系统完全独立运行

**测试要点：**
- [ ] GC 改变状态时监控系统正常
- [ ] GC 罚下机器人时监控系统仍显示数据
- [ ] 两个系统互不干扰

### 4. 测试容错性

**测试 A：关闭 Web Monitor**
```bash
pkill -f web_monitor
```
**预期：** SimRobot 和 GC 继续正常运行

**测试 B：关闭 SimRobot**
```bash
pkill -f SimRobot
```
**预期：** Web Monitor 继续运行，页面显示 "等待机器人数据..."

**测试 C：关闭浏览器**
**预期：** 后台继续记录日志，重新打开浏览器可以继续查看

## 📊 性能检查

### 检查数据采集率
```bash
# 查看最新日志文件大小
ls -lh RobotMonitoringSystem/monitor_daemon/logs/match_*/

# 统计数据包数量
wc -l RobotMonitoringSystem/monitor_daemon/logs/match_*/robot_*.jsonl
```

**预期：**
- 每个机器人每秒 4-5 个数据包
- 日志文件持续增长
- 无错误消息

### 检查 WebSocket 连接
**在浏览器中：**
1. 按 F12 打开开发者工具
2. 切换到 "Network" 或"网络" 标签
3. 筛选 "WS" 或 "WebSocket"
4. 查看连接状态

**预期：**
- ✅ WebSocket 连接成功（状态 101）
- ✅ 持续接收消息
- ✅ 无连接错误

### 检查 API 响应
```bash
# 测试机器人列表 API
curl -s http://localhost:8080/api/robots | python3 -m json.tool | head -30

# 测试比赛列表 API
curl -s http://localhost:8080/api/matches | python3 -m json.tool

# 测试日志 API
curl -s "http://localhost:8080/api/logs/match_20260128_160052/5_5?limit=5" | python3 -m json.tool
```

## ✅ 测试检查清单

### 实时监控功能
- [ ] 页面标题为中文
- [ ] 连接状态显示正确
- [ ] 显示 10 个机器人卡片
- [ ] 机器人 ID 正确（5_1-5_5, 70_1-70_5）
- [ ] 电量显示正确
- [ ] 温度显示正确
- [ ] 行为状态显示
- [ ] 运动状态显示
- [ ] 摔倒状态正确（红色背景）
- [ ] 球可见性正确（⚽/❌）
- [ ] 时间戳实时更新
- [ ] 数据每秒自动刷新
- [ ] 离线检测工作（5秒超时）

### 历史日志功能
- [ ] 比赛列表加载成功
- [ ] 机器人列表加载成功
- [ ] 日志信息显示正确
- [ ] 时间轴统计准确
- [ ] 事件列表显示
- [ ] 原始数据可查看
- [ ] 所有文字为中文

### 系统集成
- [ ] 与 GameController 共存
- [ ] 端口不冲突
- [ ] SimRobot 正常运行
- [ ] 数据采集正常
- [ ] 日志记录正常

### 容错性
- [ ] Monitor 挂掉不影响 SimRobot
- [ ] SimRobot 停止后 Monitor 继续运行
- [ ] 浏览器关闭后日志继续记录
- [ ] WebSocket 自动重连

## 🎉 测试成功标志

当你看到以下情况时，说明系统完全正常：

1. ✅ 实时监控页面显示 10 个机器人，数据实时更新
2. ✅ 历史日志页面可以查看完整数据和事件
3. ✅ GameController 和监控系统同时运行无冲突
4. ✅ 所有界面文字为中文
5. ✅ 数据采集率稳定（4-5 Hz）
6. ✅ 日志文件持续增长

## 📸 建议截图

测试时建议截图保存：
1. 实时监控页面（显示所有 10 个机器人）
2. 机器人摔倒时的红色背景效果
3. 历史日志页面（时间轴和事件列表）
4. 浏览器开发者工具（WebSocket 连接）

## 🚀 开始测试

**现在就可以开始测试了！**

打开浏览器访问：
```
http://localhost:8080/static/index.html
```

祝测试顺利！🎊
