# ğŸš€ æœºå™¨äººç›‘æ§ç³»ç»Ÿ - å¿«é€Ÿå¯åŠ¨æŒ‡å—

**ç‰ˆæœ¬**ï¼šç¨³å®šç‰ˆ v2  
**æ—¥æœŸ**ï¼š2026-01-29  
**çŠ¶æ€**ï¼šâœ… ç”Ÿäº§å°±ç»ª

---

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ

è¿™æ˜¯ä¸€ä¸ªç”¨äºç›‘æ§ RoboCup SPL æœºå™¨äººçš„å®æ—¶ Web ç³»ç»Ÿï¼š

- **å®æ—¶ç›‘æ§**ï¼š10 ä¸ªæœºå™¨äººçš„çŠ¶æ€å®æ—¶æ˜¾ç¤º
- **å†å²æ—¥å¿—**ï¼šæŸ¥çœ‹å†å²æ¯”èµ›çš„å®Œæ•´æ—¥å¿—
- **å®æ—¶æ¥å…¥**ï¼šå¯ä»¥éšæ—¶æ¥å…¥æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›
- **ç¨³å®šå¯é **ï¼šWebSocket è¿æ¥ç¨³å®šï¼Œå¯è¿è¡Œå®Œæ•´åœºæ¯”èµ›

---

## ğŸ¯ å¿«é€Ÿå¯åŠ¨ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1ï¼šå¯åŠ¨ Web Monitor

```bash
cd ~/bhuman888/MyBuman
python3 RobotMonitoringSystem/monitor_daemon/web_monitor.py
```

**é¢„æœŸè¾“å‡º**ï¼š
```
============================================================
  ğŸ¤– Robot Web Monitor - STABLE VERSION
============================================================
âœ… UDP Receiver started on port 10020
ğŸŒ Web Server: http://localhost:8080
ğŸ“Š Broadcast: 2.0 Hz
ğŸ’“ Heartbeat: every 10.0s
============================================================
âœ… Broadcast worker started (2 Hz)
```

---

### æ­¥éª¤ 2ï¼šå¯åŠ¨ SimRobot

```bash
cd ~/bhuman888/MyBuman
./Build/Linux/SimRobot/Develop/SimRobot Config/Scenes/GameFast.ros3
```

**é¢„æœŸè¾“å‡º**ï¼š
```
RobotStateReporter: Initialized, sending to 127.0.0.1:10020
RobotStateReporter: Initialized, sending to 127.0.0.1:10020
... (10 ä¸ªæœºå™¨äºº)
```

---

### æ­¥éª¤ 3ï¼šæ‰“å¼€ Web ç•Œé¢

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

**å®æ—¶ç›‘æ§é¡µé¢**ï¼š
```
http://localhost:8080/static/index.html
```

**æ—¥å¿—æŸ¥çœ‹é¡µé¢**ï¼š
```
http://localhost:8080/static/logs.html
```

---

## ğŸ–¥ï¸ ç•Œé¢è¯´æ˜

### å®æ—¶ç›‘æ§é¡µé¢ï¼ˆindex.htmlï¼‰

**åŠŸèƒ½**ï¼š
- æ˜¾ç¤º 10 ä¸ªæœºå™¨äººçš„å®æ—¶çŠ¶æ€å¡ç‰‡
- æ¯ä¸ªå¡ç‰‡æ˜¾ç¤ºï¼š
  - æœºå™¨äºº ID
  - åœ¨çº¿çŠ¶æ€ï¼ˆğŸŸ¢ åœ¨çº¿ / ğŸ”´ ç¦»çº¿ï¼‰
  - ç”µé‡ç™¾åˆ†æ¯”
  - æ¸©åº¦
  - è¡Œä¸ºçŠ¶æ€
  - è¿åŠ¨çŠ¶æ€
  - æ‘”å€’çŠ¶æ€
  - çƒå¯è§æ€§
  - ä½ç½®åæ ‡

**æ›´æ–°é¢‘ç‡**ï¼š2 Hzï¼ˆæ¯ 500ms æ›´æ–°ä¸€æ¬¡ï¼‰

**è¿æ¥çŠ¶æ€**ï¼š
- ğŸŸ¢ å·²è¿æ¥ï¼šWebSocket è¿æ¥æ­£å¸¸
- ğŸ”´ æœªè¿æ¥ï¼šWebSocket æ–­å¼€ï¼ˆä¼šè‡ªåŠ¨é‡è¿ï¼‰

---

### æ—¥å¿—æŸ¥çœ‹é¡µé¢ï¼ˆlogs.htmlï¼‰

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹å†å²æ¯”èµ›æ—¥å¿—
- å®æ—¶æ¥å…¥æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›
- äº‹ä»¶åˆ†æ
- åŸå§‹æ•°æ®æŸ¥çœ‹

**ç‰¹è‰²åŠŸèƒ½**ï¼š
- ğŸ”´ æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›æ¨ªå¹…ï¼ˆå¦‚æœæœ‰ï¼‰
- ğŸ“¡ ä¸€é”®æ¥å…¥å®æ—¶æ—¥å¿—
- ğŸ“Š è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯ 2 ç§’ï¼‰
- ğŸ“‹ äº‹ä»¶ç»Ÿè®¡

---

## ğŸ”§ API æ¥å£

### 1. è·å–æ‰€æœ‰æœºå™¨äººçŠ¶æ€

```bash
curl http://localhost:8080/api/robots
```

**å“åº”**ï¼š
```json
{
  "robots": [
    {
      "robot_id": "5_1",
      "online": true,
      "state": {
        "battery": 100.0,
        "temperature": 40.0,
        "fallen": false,
        ...
      }
    },
    ...
  ]
}
```

---

### 2. è·å–å½“å‰æ¯”èµ›ä¿¡æ¯

```bash
curl http://localhost:8080/api/current_match
```

**å“åº”ï¼ˆæ¯”èµ›è¿›è¡Œä¸­ï¼‰**ï¼š
```json
{
  "active": true,
  "match_id": "match_20260129_141734",
  "start_time": 1769667454.4385164,
  "duration": 45.14521384239197,
  "robot_count": 10,
  "robots": [
    "5_1", "5_2", "5_3", "5_4", "5_5",
    "70_1", "70_2", "70_3", "70_4", "70_5"
  ]
}
```

**å“åº”ï¼ˆæ— æ¯”èµ›ï¼‰**ï¼š
```json
{
  "active": false
}
```

---

### 3. è·å–å½“å‰æ¯”èµ›çš„æœºå™¨äººåˆ—è¡¨

```bash
curl http://localhost:8080/api/current_match/robots
```

**å“åº”**ï¼š
```json
{
  "robots": [
    {
      "robot_id": "5_1",
      "packet_count": 1234,
      "last_update": 1769667454.5,
      "online": true
    },
    ...
  ]
}
```

---

### 4. è·å–å®æ—¶æ—¥å¿—

```bash
curl http://localhost:8080/api/current_match/logs/5_1?limit=50
```

**å“åº”**ï¼š
```json
{
  "match_id": "match_20260129_141734",
  "robot_id": "5_1",
  "is_active": true,
  "total_packets": 1234,
  "data": [
    {
      "robot_id": "5_1",
      "timestamp": 143732,
      "battery": 100.0,
      ...
    },
    ...
  ]
}
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: Web Monitor å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**ï¼š
```
Address already in use
```

**è§£å†³**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8080

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# é‡æ–°å¯åŠ¨
python3 RobotMonitoringSystem/monitor_daemon/web_monitor.py
```

---

### Q2: SimRobot æ— æ³•è¿æ¥

**ç—‡çŠ¶**ï¼š
- Web ç•Œé¢æ˜¾ç¤º "0 ä¸ªæœºå™¨äºº"
- æ—¥å¿—ä¸­æ²¡æœ‰ "Received from" æ¶ˆæ¯

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ UDP ç«¯å£æ˜¯å¦ç›‘å¬
netstat -uln | grep 10020

# æ£€æŸ¥ SimRobot æ˜¯å¦è¿è¡Œ
ps aux | grep SimRobot
```

**è§£å†³**ï¼š
1. ç¡®ä¿ Web Monitor å…ˆå¯åŠ¨
2. å†å¯åŠ¨ SimRobot
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

---

### Q3: WebSocket é¢‘ç¹æ–­è¿

**ç—‡çŠ¶**ï¼š
- è¿æ¥çŠ¶æ€é¢‘ç¹åˆ‡æ¢
- æ—¥å¿—ä¸­é¢‘ç¹å‡ºç° "Client connected" / "Client disconnected"

**è§£å†³**ï¼š
- âœ… å·²åœ¨ v2 ç‰ˆæœ¬ä¸­ä¿®å¤
- ç¡®ä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ `web_monitor.py` å’Œ `monitor.js`

---

### Q4: æµè§ˆå™¨æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼š
```
ERR_CONNECTION_REFUSED
```

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ HTTP ç«¯å£æ˜¯å¦ç›‘å¬
netstat -tln | grep 8080

# æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œ
ps aux | grep web_monitor
```

**è§£å†³**ï¼š
1. ç¡®ä¿ Web Monitor æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
3. å°è¯•ä½¿ç”¨ `127.0.0.1` è€Œä¸æ˜¯ `localhost`

---

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### æ£€æŸ¥ç³»ç»ŸçŠ¶æ€

```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep -E "(web_monitor|SimRobot)"

# æ£€æŸ¥ç«¯å£
netstat -tuln | grep -E "(8080|10020)"

# æ£€æŸ¥æ—¥å¿—
tail -f RobotMonitoringSystem/monitor_daemon/logs/match_*/robot_*.jsonl
```

---

### æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ­£å¸¸å€¼ | è¯´æ˜ |
|------|--------|------|
| UDP æ¥æ”¶ç‡ | 50 åŒ…/ç§’ | 10 ä¸ªæœºå™¨äºº Ã— 5 Hz |
| WebSocket æ¨é€ç‡ | 2 Hz | èŠ‚æµåçš„æ¨é€é¢‘ç‡ |
| å†…å­˜å ç”¨ | < 100 MB | Python è¿›ç¨‹ |
| CPU å ç”¨ | < 5% | æ­£å¸¸è¿è¡Œæ—¶ |
| WebSocket è¿æ¥æ•° | 1-5 | æµè§ˆå™¨æ ‡ç­¾é¡µæ•°é‡ |

---

## ğŸ”„ é‡å¯ç³»ç»Ÿ

### å®Œå…¨é‡å¯

```bash
# 1. åœæ­¢æ‰€æœ‰è¿›ç¨‹
pkill -f web_monitor.py
pkill -f SimRobot

# 2. ç­‰å¾… 2 ç§’
sleep 2

# 3. å¯åŠ¨ Web Monitor
python3 RobotMonitoringSystem/monitor_daemon/web_monitor.py &

# 4. ç­‰å¾… 2 ç§’
sleep 2

# 5. å¯åŠ¨ SimRobot
./Build/Linux/SimRobot/Develop/SimRobot Config/Scenes/GameFast.ros3 &
```

---

### åªé‡å¯ Web Monitor

```bash
# åœæ­¢
pkill -f web_monitor.py

# å¯åŠ¨
python3 RobotMonitoringSystem/monitor_daemon/web_monitor.py
```

---

## ğŸ“ æ—¥å¿—æ–‡ä»¶ä½ç½®

### æ¯”èµ›æ—¥å¿—

```
RobotMonitoringSystem/monitor_daemon/logs/
â”œâ”€â”€ match_20260129_141734/
â”‚   â”œâ”€â”€ robot_5_1.jsonl
â”‚   â”œâ”€â”€ robot_5_2.jsonl
â”‚   â”œâ”€â”€ ...
â”‚   â””â”€â”€ robot_70_5.jsonl
â”œâ”€â”€ match_20260129_120624/
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### æ—¥å¿—æ ¼å¼

æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼ˆJSON Lines æ ¼å¼ï¼‰ï¼š

```json
{"robot_id": "5_1", "timestamp": 143732, "battery": 100.0, ...}
{"robot_id": "5_1", "timestamp": 143733, "battery": 99.9, ...}
...
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå®æ—¶ç›‘æ§æ¯”èµ›

1. å¯åŠ¨ Web Monitor å’Œ SimRobot
2. æ‰“å¼€ `index.html`
3. è§‚å¯Ÿæœºå™¨äººçŠ¶æ€å¡ç‰‡
4. æ¯”èµ›ç»“æŸåï¼Œæ—¥å¿—è‡ªåŠ¨ä¿å­˜

---

### åœºæ™¯ 2ï¼šæŸ¥çœ‹å†å²æ¯”èµ›

1. æ‰“å¼€ `logs.html`
2. é€‰æ‹©å†å²æ¯”èµ›
3. é€‰æ‹©æœºå™¨äºº
4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—å’Œäº‹ä»¶åˆ†æ

---

### åœºæ™¯ 3ï¼šæ¥å…¥æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›

1. æ¯”èµ›å·²ç»å¼€å§‹ï¼ˆSimRobot æ­£åœ¨è¿è¡Œï¼‰
2. æ‰“å¼€ `logs.html`
3. çœ‹åˆ° "ğŸ”´ æ­£åœ¨è¿›è¡Œçš„æ¯”èµ›" æ¨ªå¹…
4. ç‚¹å‡» "ğŸ“¡ æ¥å…¥å®æ—¶æ—¥å¿—"
5. å®æ—¶æŸ¥çœ‹æ—¥å¿—ï¼ˆæ¯ 2 ç§’åˆ·æ–°ï¼‰

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **æ¶æ„è®¾è®¡**ï¼š`COMMUNICATION_PRINCIPLE.md`
- **ç¨³å®šæ€§åˆ†æ**ï¼š`WEBSOCKET_STABILITY_DEEP_DIVE.md`
- **ä¿®å¤æŠ¥å‘Š**ï¼š`WEBSOCKET_STABILITY_FIX_FINAL.md`
- **å®æ—¶æ¥å…¥åŠŸèƒ½**ï¼š`ACTIVE_MATCH_DESIGN.md`
- **ç³»ç»Ÿæ£€æµ‹æŠ¥å‘Š**ï¼š`SYSTEM_CHECK_REPORT.md`

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š

1. **æ—¥å¿—æ–‡ä»¶**ï¼šæ£€æŸ¥ Web Monitor çš„è¾“å‡º
2. **æµè§ˆå™¨æ§åˆ¶å°**ï¼šæ£€æŸ¥ JavaScript é”™è¯¯
3. **ç½‘ç»œè¿æ¥**ï¼šæ£€æŸ¥ç«¯å£å’Œé˜²ç«å¢™
4. **æ–‡æ¡£**ï¼šæŸ¥çœ‹ç›¸å…³æŠ€æœ¯æ–‡æ¡£

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
