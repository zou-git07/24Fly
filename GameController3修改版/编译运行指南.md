# GameController 编译运行指南

## 前提条件

在编译之前，请确保已安装以下工具：

### 必需工具

1. **Rust 和 Cargo**
   ```bash
   # 安装 Rust（如果尚未安装）
   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
   ```

2. **Node.js 和 npm**
   ```bash
   # 检查是否已安装
   node --version
   npm --version
   ```

3. **libclang**（用于 bindgen）
   - Linux: `sudo apt install libclang-dev`
   - macOS: 通常已随 Xcode 安装
   - Windows: `winget install LLVM`

4. **Tauri 依赖**
   - 详见：https://tauri.app/start/prerequisites/

## 编译步骤

### 方法一：使用编译脚本（推荐）

最简单的方式是使用提供的编译脚本：

```bash
cd GameController3修改版
./build_with_pause_button.sh
```

脚本会自动完成前端和后端的编译。

### 方法二：手动编译

#### 1. 编译前端

```bash
cd GameController3修改版/frontend

# 安装依赖（首次编译或依赖更新时）
npm ci
# 或者使用 npm install

# 编译前端
npm run build
```

#### 2. 编译后端

```bash
cd ..  # 回到 GameController3修改版 目录

# Release 模式编译（推荐，性能更好）
cargo build --release

# 或者 Debug 模式编译（编译更快，但运行较慢）
cargo build
```

## 运行 GameController

### 运行 Release 版本

```bash
cd GameController3修改版

# 方法 1：使用 cargo run
cargo run --release

# 方法 2：直接运行编译好的二进制文件
./target/release/game_controller_app
```

### 运行 Debug 版本

```bash
cargo run
# 或
./target/debug/game_controller_app
```

### 使用运行脚本

```bash
./run_gamecontroller.sh
```

## 开发模式

如果需要进行开发和调试，推荐使用 Tauri 的开发模式：

```bash
# 首次使用需要安装 tauri-cli
cargo install tauri-cli

# 启动开发模式（支持热重载）
cargo tauri dev
```

开发模式会自动监听文件变化并重新编译，适合快速迭代开发。

## 命令行参数

GameController 支持命令行参数来覆盖默认设置：

```bash
# 查看所有可用参数
cargo run --release -- -h

# 示例：指定网络接口
cargo run --release -- --interface eth0
```

## 常见问题

### 前端编译失败

如果前端编译失败，尝试：
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run build
```

### Rust 编译失败

1. 确保 Rust 工具链是最新的：
   ```bash
   rustup update
   ```

2. 清理并重新编译：
   ```bash
   cargo clean
   cargo build --release
   ```

### libclang 找不到（Windows）

设置环境变量：
```powershell
$env:LIBCLANG_PATH = "C:\Program Files\LLVM\bin\"
```

## 创建发行版

如果需要创建二进制发行版，使用 `dist/` 目录下的脚本：

```bash
cd dist
./build-linux.sh 1.0.0  # Linux
./build-macos.sh 1.0.0  # macOS
./build-windows.sh 1.0.0  # Windows
```

## 配置文件

运行时配置文件位于 `config/` 目录：
- `teams.yaml` - 所有 SPL 队伍列表
- 各子比赛目录下的 `params.yaml` 和 `teams.yaml`

## 日志文件

GameController 会将日志写入 `logs/` 目录，格式为 YAML。

## 网络通信

GameController 使用以下端口：
- **3838** - 控制消息（UDP 广播）
- **3939** - 机器人状态消息（UDP 单播）
- **3636** - 监控请求（UDP 单播）
- **3940** - 转发状态消息（UDP 单播）
- **10000 + 队伍编号** - 队伍消息（UDP 广播）

确保防火墙允许这些端口的通信。

## 修改版特性

本修改版包含以下增强功能：
- ✅ 全部暂停按钮
- ✅ 可调节窗口大小
- ✅ 机器人状态监测
- ✅ 双击测试功能

详见各功能的专门文档。
